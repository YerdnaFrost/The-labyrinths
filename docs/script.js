const PASSWORD="00000";let attempts=0;const MAX_ATTEMPTS=5;let currentPassword="";function addDigit(_){currentPassword.length<5&&(currentPassword+=_,updatePasswordDisplay(),5===currentPassword.length&&checkPassword())}function deleteDigit(){currentPassword.length>0&&(currentPassword=currentPassword.slice(0,-1),updatePasswordDisplay())}function clearDigits(){currentPassword="",updatePasswordDisplay()}function updatePasswordDisplay(){let _=document.querySelectorAll(".password-digit");_.forEach((_,$)=>{_.textContent=$<currentPassword.length?currentPassword[$]:"•"})}function checkPassword(){if("00000"===currentPassword)document.getElementById("passwordScreen").style.display="none",document.getElementById("mainScreen").style.display="block",initGame();else{attempts++,currentPassword="",updatePasswordDisplay();let _=document.getElementById("passwordError");_.classList.add("visible"),attempts>=5&&(document.body.innerHTML='<div style="text-align: center; padding: 50px; font-size: 24px; color: #ff4444;">Доступ заблокирован</div>')}}function initPasswordKeyboard(){let _=document.getElementById("numpad"),$=document.getElementById("clearButton"),e=document.getElementById("deleteButton");_.querySelectorAll("[data-digit]").forEach(_=>{_.addEventListener("click",()=>{addDigit(_.getAttribute("data-digit"))})}),$.addEventListener("click",clearDigits),e.addEventListener("click",deleteDigit)}function initGame(){let _=[["010101111110100100","111100010011111110","010111111010101011","010000011110100001","111111001010101011","100011101000111001","110110101101101111","000000101000100010","111111111111101111","010010001101100100","010111100100111101","110000110110000111","011110100011111100","000100111001000101","110110001101110101","010111111100011111","111101100101001001","110100110111111101"],["110111001001101011","010101111101001001","111101010111111101","110001000000100111","100111111111110010","110101000010010111","010001000111010101","111011110001000101","001110111011111100","101000001010001001","111010101111101111","101110100010101001","001011111110001100","111000101011111110","110011100010101011","010110101111101000","110010001001001111","111111111101011010"],["000110100100110101","010010101110100111","110110111011110100","010100100010011111","011111110111001011","110101010001011110","100001011101010011","111101000111111010","010111010101001011","010001011101101010","111011110001001110","100000010101011011","111111111111011110","010001000101110011","111011111100110110","010001010110011100","011111000111110111","110101011100100101"],["011111010101100111","000101110101111101","111101010100100100","000101110111110111","011100010100011100","010111010101110111","110001111100100101","111111010001110111","100011011111000110","111010000101010010","001010101101010111","111011111001010100","101110101011111110","100010001010000010","110111111010101111","010101010011101011","010100010110100010","111110111100111111"],["111001110101111111","101101010100010001","001001011111111011","101111001010001001","111001100010101101","010011111010100111","110110001010111101","010010101110101001","111110101011101111","100010111000001001","110111101110111011","010110000100010000","010100111111111101","111101100001010111","000100101101000100","011111101001011111","110010111101001010","011010010111100011"]],$=[],e=null;function t(_){let $={mazes:[]};for(let e of _.mazes){let t={cells:JSON.parse(JSON.stringify(e.cells)),paths:[]};for(let s of e.paths){let l={cells:new Map(s.cells),sources:new Set(s.sources),treasures:new Set(s.treasures),closeCells:new Set(s.closeCells)};t.paths.push(l)}$.mazes.push(t)}return $}function s(){$.push(t(e))}function l(){e={mazes:[]};for(let t=0;t<_.length;t++){let s=_[t],l=s.length,r=s[0].length,a={cells:[],paths:[]};for(let c=0;c<l;c++){let d=[];for(let i=0;i<r;i++)d.push({isWall:"0"===s[c][i],isPath:"1"===s[c][i]});a.cells.push(d)}for(let u=0;u<l;u++)for(let f=0;f<r;f++)"1"===s[u][f]&&a.paths.push({cells:new Map([[`${f},${u}`,"current"]]),sources:new Set,treasures:new Set,closeCells:new Set});e.mazes.push(a)}$=[],n(),o()}function n(){for(let $=0;$<_.length;$++)a($)}function r(_,$,e){let t=_.cells[e][$];if(t.isWall)return"wall";let s=`${$},${e}`,l=!1,n=!1,r=!1,a=!1,o=!1;for(let c of _.paths){let d=c.cells.get(s);"current"===d&&(l=!0),c.sources.has(s)&&(n=!0),"visited"===d&&(r=!0),c.treasures.has(s)&&(a=!0),c.closeCells.has(s)&&(o=!0)}return l?"possible":o?"close":a?"treasure":n?"source":r?"visited":"path"}function a(_){let $=document.getElementById(`maze-${_}`),t=e.mazes[_];if(!$)return;$.innerHTML="";let s=t.cells.length,l=t.cells[0].length;$.style.gridTemplateColumns=`repeat(${l}, 10px)`;for(let n=0;n<s;n++)for(let a=0;a<l;a++){let o=document.createElement("div");o.className="cell",o.classList.add(r(t,a,n)),$.appendChild(o)}}function o(){let _=0,$=0;for(let t of e.mazes){let s=new Set,l=new Set;for(let n of t.paths){for(let[r,a]of n.cells)("visited"===a||"current"===a)&&s.add(r);for(let o of n.sources)s.add(o);for(let c of n.treasures)s.add(c),l.add(c);for(let d of n.closeCells)s.add(d)}_+=s.size,$+=l.size}document.getElementById("cells-passed").textContent=`Пройдено клеток: ${_}`,document.getElementById("treasure-collected").textContent=`Собрано добычи: ${$}`}function c($){s();let t=0,l=!1;for(let r=0;r<_.length;r++){let a=e.mazes[r],c=_[r],i=c.length,u=c[0].length,f=[];for(let p of a.paths){let h,g,m;for(let[w,y]of p.cells)if("current"===y){[h,g]=w.split(",").map(Number),m=w;break}if(void 0===h||void 0===g)continue;let E=h,P=g;switch($){case"north":P--;break;case"south":P++;break;case"west":E--;break;case"east":E++}if(E>=0&&E<u&&P>=0&&P<i&&"1"===c[P][E]){let v={cells:new Map(p.cells),sources:new Set(p.sources),treasures:new Set(p.treasures),closeCells:new Set(p.closeCells)};v.cells.set(m,"visited"),v.cells.set(`${E},${P}`,"current"),f.push(v)}else l=!0}a.paths=f,t+=f.length}if(0===t&&l){alert("Вы определённо упёрлись в стену. Возвращаемся к предыдущему состоянию."),d();return}n(),o()}function d(){if($.length>0){var _;e=t(_=$.pop()),n(),o()}}l(),document.getElementById("north").addEventListener("click",()=>c("north")),document.getElementById("south").addEventListener("click",()=>c("south")),document.getElementById("west").addEventListener("click",()=>c("west")),document.getElementById("east").addEventListener("click",()=>c("east")),document.getElementById("close").addEventListener("click",function _(){s();for(let $=0;$<e.mazes.length;$++){let t=e.mazes[$];for(let l of t.paths){let r=null;for(let[a,c]of l.cells)if("current"===c){r=a;break}r&&l.closeCells.add(r)}}n(),o()}),document.getElementById("set-source").addEventListener("click",function _(){s();for(let $=0;$<e.mazes.length;$++){let t=e.mazes[$];for(let l of t.paths){let r=null;for(let[a,c]of l.cells)if("current"===c){r=a;break}r&&l.sources.add(r)}}n(),o()}),document.getElementById("set-treasure").addEventListener("click",function _(){s();for(let $=0;$<e.mazes.length;$++){let t=e.mazes[$];for(let l of t.paths){let r=null;for(let[a,c]of l.cells)if("current"===c){r=a;break}r&&l.treasures.add(r)}}n(),o()}),document.getElementById("undo").addEventListener("click",d),document.getElementById("reset").addEventListener("click",function _(){$=[],l()})}window.onload=function(){document.getElementById("passwordScreen").style.display="flex",document.getElementById("mainScreen").style.display="none",initPasswordKeyboard()};